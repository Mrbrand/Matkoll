<!DOCTYPE html>
<html>
	<head>
		<title>Memory</title> 
		
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type" />
		<link rel="apple-touch-icon" href="img/icon.png"/>
		
		<link rel="stylesheet" type="text/css" href="style.css"/>
		<link rel="stylesheet" type="text/css" href="carbon.css"/>
		
		<script language="JavaScript" type="text/javascript" src="javascript/moment.min.js"></script>
		<script language="JavaScript" type="text/javascript" src="javascript/mustache.js"></script>	
		<script language="JavaScript" type="text/javascript" src="javascript/carbon.js"></script>
		<script language="JavaScript" type="text/javascript" src="javascript/jquery-2.1.3.min.js"></script> 
		<script language="JavaScript" type="text/javascript" src="javascript/jquery.detect_swipe.js"></script> 
		<script language="JavaScript" type="text/javascript" src="javascript/tinysort.js"></script>
		
	</head>
	
	<body>
	
	
	
		<!--TREE PAGE -------------->
			<div id="tree" class="page" style="display:block; min-height:450px;">
			  
			<div id="header">
				<div class="menu-title">Root</div>
				<img class="search-button" src="img/search-icon.png"  style="float:right; margin:5px; cursor:pointer;"/>
			</div> <!--end header-->
			
			<!--Sub-meny-->
			<div class="submenu">
				<button class="back-button">Back</button>
				<button class="new-button">New</button>
				
			</div><!-- end controls-->
			
			<!-- Projektlista -->
			<div id="items">
				<div id="open"></div>
				<div id="finished"></div>
			</div><!-- end items--> 
			
		</div><!-- end page-->

		
		
		<!--SEARCH PAGE -------------->
			<div id="search" class="page" style="display:block;">
			  
			<div id="header">
				<div style="float:left;">Search</div>
				<img class="tree-button" src="img/tree-icon.png"  style="float:right; margin:5px; cursor:pointer;"/>
			</div> <!--end header-->
			
			<!--Sub-meny-->
			<div class="submenu">
				
				<!--Search input-->
				<input class="search" onkeyup="view_filter();" placeholder="Search string" style="width:45%;"/>
				
				<!--Select type-->
				<select class="type-filter" onchange="view_filter();">
					<option value="all">-ALL-</option>
					<option value="6">-General Task</option>
               <option value="14">-Home</option>
        			<option value="9">-Telephone</option>
					<option value="10">-Computer</option>
               <option value="11">-Away</option>
               <option value="12">-Planning</option>
					<option value="4">-Idea</option>
               <option value="5">-Problem</option>
					<option value="7">-Project</option> 
					<option value="13">-Category</option> 
					<option value="100">-Document</option>  
					<option disabled>Programming:</option>
					<option value="1">-Coding</option>  
					<option value="2">-Sketch</option>
					<option value="3">-Solve</option>
					<option value="8">-Page</option>  
				</select>
				
				
			</div><!-- end controls-->
			
			<!-- ItemLista -->
			<div id="items">
				<div id="filtered"></div>
			</div><!-- end items--> 
			
		</div><!-- end page-->
		
		
		
		<!-- EDIT item ---------------------------------------------------------------------->
		<div id="edit" class="page">
			
			<div id="header">
				<div class="menu-title">-item-title-</div>
			</div> <!--end header-->
			
			<!--Sub-meny-->
			<div class="submenu">
				<button class="cancel-button">Cancel</button>
				<button class="save-button" style="width:70px; float:right;margin-left:5px;"><img src="img/save.png" /></button>
				<button class="delete-button" style="width:70px; float:right;margin-left:5px;"><img src="img/delete2.png" /></button>
				<br/><br/>
			</div><!-- end controls--> 
			
			<form id="edit-item-form">
				<input class="item-title" name="title" type="text" style="margin-bottom:5px;height:50px; font-size:1.3em"/><br/>

			  	<input class="year" name="year" type="text" style="width:40px;margin-bottom:5px;float:left;"/>
			  	<input class="month" name="month" type="text" style="width:40px;margin-bottom:5px;float:left;"/>
			  	<input class="day" name="day" type="text" style="width:40px;margin-bottom:5px;float:left;"/>
				
		     <select class="category" name="category" style="margin-bottom:5px;height:40px;">
		         <option value="">--Kategori--</option>
		         <option value="Boende">Boende</option>
		         <option value="Jobb/ Studier">Jobb/ Studier</option>
		         <option value="Familj">Familj</option>
		         <option value="Hälsa">Hälsa</option>
		         <option value="Webb">Webb</option>
		         <option value="Nöje">Nöje</option>
		     </select><br/>
				
				<select class="importance" name="importance" style="margin-bottom:5px;height:40px;">
					<option value="">--Set importance--</option>
		         <option value="1">1-Milstolpe</option>
		         <option value="2">2-Event</option>
		         <option value="3">3-Händelse</option>
		         <option value="4">4-Företeelse</option>
		         <option value="5">5-Anteckning</option>
				</select><br/>
				
				<textarea class="item-notes" name="notes" rows="7" placeholder="Notes"></textarea>
			
				<center>
					<button class="more-button" type='button'>More options</button>
				</center>
				<div class="more" style="display:none;">
					<span class="field-description">id:</span>
					<input class="item-id" name="id" type="text" readonly="readonly" style="color:#CCC;"/> <br/>
					<span class="field-description">parent_id:</span>
					<input class="item-parent-id" name="parent_id" type="text" style="margin-bottom:5px;"/><br/>
					<span class="field-description">Finish date</span>
					<input class="finish_date" name="finish_date" type="text" style="margin-bottom:5px;height:40px; font-size:1.1em"/><br/>
				</div>
				
			</form>
		</div><!--edit-item--> 

		<!-- NEW item--------------------------------------------------------------------------->
		<div id="new" class="page">
			
			<div id="header">
				<div class="menu-title">-new item-</div>
			</div> <!--end header-->
			
			<!--Sub-meny-->
			<div class="submenu">
				<button class="cancel-button">Cancel</button>
				<button class="add-button">Add</button>
			</div><!-- end controls--> 
			
			
			
			<form id="new-item-form">
				<textarea  id="new-item-title" name="title" placeholder="Title" rows="1" style="margin-bottom:5px;height:50px; font-size:1.3em; padding-top: 11px;"></textarea><br/>
				
				<select id="new-item-prio" name="prio" style="margin-bottom:5px;height:40px;">
					<option value="1">Prio 1</option> 
					<option value="2">Prio 2</option> 
					<option value="3" selected="selected">Prio 3</option> 
					<option value="4">Prio 4</option> 
					<option value="5">Prio 5</option>
				</select><br/>
				
				<select id="new-item-type" name="type" style="margin-bottom:5px;height:40px;">
					<option value="6">-General Task</option>
                    <option value="14">-Home</option>
        			<option value="9">-Telephone</option>
					<option value="10">-Computer</option>
                    <option value="11">-Away</option>
                    <option value="12">-Planning</option>
					<option value="4">-Idea</option>
                    <option value="5">-Problem</option>
					<option value="7">-Project</option> 
					<option value="13">-Category</option> 
					<option value="100">-Document</option>  
					<option disabled>Programming:</option>
					<option value="1">-Coding</option>  
					<option value="2">-Sketch</option>
					<option value="3">-Solve</option>
					<option value="8">-Page</option>  
				</select>
				
				 <select id="new-item-size" name="size" style="margin-bottom:5px;height:40px;">
					<option value="6" selected>--Set size--</option>
					<option value="1">Quick (5min)</option>
					<option value="2">Small (<15min)</option>
					<option value="3">Medium (<1h)</option>
					<option value="4">Large (<3h)</option>
					<option value="5">XLarge (>3h)</option>
				</select><br/>
				
				<textarea id="new-item-notes" name="notes" placeholder="Notes" rows="5"></textarea>
				
				<input type="hidden" name="parent_id" id="new-parent-id" value="0"/>
				<input type="hidden" name="status" value="open" placeholder="Status" style="margin-bottom:5px;"/>
				
			</form>
			<br/><br/><br/><br/><br/><br/><br/>
		</div><!-- end new-item--> 
	
	</body>
</html>



<!MENU >
		<div id="menu" class="page">
			
			<div id="header">
				<div class="menu-title">MENU</div>
				<img class="cancel-button" src="img/menu-button.png"  style="float:right; margin:5px;"/>
			</div> <end header-->
			<!--button onclick="window.open('mailto:test@example.com?subject=WiseGuy backup&body='+JSON.stringify(itemList.itemArray));">Mail backup</button-->
			
			<textarea class="json-input" rows="5" placeholder="JSON"></textarea>
			<button onclick="myString = $('.json-input').val().replace('/[\r\n]/g', '<br />'); itemList.itemArray = JSON.parse(myString);">Till local</button><br/><br/>
			
			<input class="json-output" type="text" />
			
			
			<!--span style="color:white;">These functions are experimental, use with caution!</span> <br/>
			<button onclick="if (confirm('Previous data will be erased!')==true) {itemList.cleardata(); view_item(0);}" style="margin:10px;">Clear data</button><br/>
			<button onclick="if (confirm('Previous data will be erased!')==true) {itemList.testdata(); itemList.refresh(0);view_item(0);}" style="margin:10px;">Test data (50000 randomized items)</button><br/>

		</div><!-- end menu--> 
	</body>
</html>



<!-- Mustache template öppna-->
<script id="open_items_template" type="text/template">
	<div class="subitem project">
						
		<div class="subitem-left quick_edit_item">
			<img class="prio-icon" src="img/prio5.png"/>
			<!img class="type-icon" style="margin:4px 7px;" src="img/type{{type}}.png"/>
			<div class="category" style="">{{category}}</div>
			<img class="type-icon" style="margin:0;" src="img/size{{importance}}.png"/>
		</div>
		
		<div class="subitem-center">
			<div class="title" style="">{{title}}</div>
			<div class="next_action_div" style="float:left;">
			<span class="date">{{year}}-{{month}}-{{day}}</span><br/>
				{{#notes}}<span class="notes">{{notes}}</span>{{/notes}}
			</div>
		</div><!-- end subitem-center -->
		 
		<div style="clear:both;"></div>
		
		<span class="item_id" style="display:none;">{{id}}</span>
		<span class="importance" style="display:none;">{{importance}}</span>
		
		<span class="year" style="display:none;">{{year}}</span>
		<span class="month" style="display:none;">{{month}}</span>
		<span class="day" style="display:none;">{{day}}</span>
		
		
	</div>
</script>	
	
	
<!-- Mustache template search -->
<script id="filtered_items_template" type="text/template">
	<div class="subitem project{{#finish_date}} finished{{/finish_date}}">
						
		<div class="subitem-left quick_edit_item">
			<img class="prio-icon" src="img/prio{{prio}}.png"/>
			<img class="type-icon" style="margin:4px 7px;" src="img/type{{type}}.png"/>
			<img class="type-icon" style="margin:0;" src="img/size{{size}}.png"/>
		</div>
		
		<div class="subitem-center">
			<div class="title" style="">{{title}}</div>
			{{#path}}<div class="path" style="">{{path}}</div>{{/path}}
			<div class="next_action_div" style="float:left;">
				<span class="finish_date">{{finish_date}}</span>
				{{#notes}}<span class="notes">{{notes}}</span>{{/notes}}
				
			</div>
		</div><!-- end subitem-center -->
		 
		<div style="clear:both;"></div>
		
		<span class="item_id" style="display:none;">{{id}}</span>
		<span class="prio" style="display:none;">{{prio}}</span>
		<span class="type" style="display:none;">{{type}}</span>
		<span class="size" style="display:none;">{{size}}</span>
	
	</div><!-- end subitem  -->
</script>	
	
	
<!-- Navigerings script -->	
<script>
	
	// Uppstart
	var current = {id:0, parent_id:0, title:"Alla"};
	var view = "tree";
	var latest_swipe;
	itemList.init("memory");
	if (itemList.itemArray==undefined) itemList.exampledata();
	itemList.filtered("all","");
	view_item(0);
	

	// .subitem-left (visa edit-läge)
	$(document).on('click', ".subitem-left", function() {
		
		var id = $(this).parent().find(".item_id").text();
		edit_item = itemList.get_item(id);
    
		$(".menu-title").html("Edit: "+edit_item.title);
		
     	$("input.item-id").val(id);
     	$("input.item-title").val(edit_item.title);
     	$("textarea.item-notes").val(edit_item.notes);
		$(".year").val(edit_item.year);
     	$(".month").val(edit_item.month);
     	$(".day").val(edit_item.day);
 		$(".importance").val(edit_item.importance);
     	$("input.item-parent-id").val(edit_item.parent_id);
		
			/*$("input.item-category").val(current.category);
        $("input.item-create-date").val(current.date_create);
        $("input.item-finish-date").val(current.date_finished);*/
				
		$(".page").hide();
		$("#edit").show();
		
		$('.more').hide();
		$('.more-button').show();
    });
    
	
	// .subitem-center (visa subitems)
	$(document).on('click', ".subitem-center", function() {
		var current_id = $(this).parent().find(".item_id").text();
		view_item (current_id);
    });
    
    
    
	// .new-button
	$(document).on('click', ".new-button", function() {
 
		$(".menu-title").html("New: "+current.title);
      $("input.item-id").val(current.id);
      $("#new-item-title").val("");
      $("#new-item-prio").val("2");
      //$("#new-item-type").val("6");   // visar senaste om bortkommenterad
      $("#new-item-notes").val("");
      $("#new-item-size").val("6");
      $("#new-parent-id").val(current.id);
		
		$(".page").hide();
		$("#new").show();
    });
	
	// .add-button
	$(document).on('click', ".add-button", function() {
        itemList.add_from_form("#new-item-form");
		view_item(current.id);
    });
	
	
	// .save-button
	$(document).on('click', ".save-button", function() {
      itemList.edit_from_form("#edit-item-form");
		if(view=="tree")	view_item(current.id);
		else view_filter();
    });
	
	
	// .more-button
	$(document).on('click', ".more-button", function() {
		$('.more').show();
		$('.more-button').hide();
    });
	
	// .back-button
    $(document).on('click', ".back-button", function() {
		view_item(current.parent_id);
    });

	//swipe back
	$("#tree").on('swiperight',  function(){ 
		if(current.parent_id!=-1)
			view_item(current.parent_id);
	});

//swipe to backend menu
	$("#tree").on('swipeleft',  function(){ 
		if(Date.now()  - latest_swipe <200){
			alert("2 left swipes -> Backdoor menu");
			$(".json-output").val(JSON.stringify(window.localStorage.getItem("memory")));
			$(".page").hide();
			$("#menu").show();
		}
		latest_swipe = Date.now();
	});

	
	// .cancel-button
   $(document).on('click', ".cancel-button", function() {
     	if(view=="tree")	view_item(current.id);
		else view_filter();
    });
	
	// .delete-button
   $(document).on('click', ".delete-button", function() {
		id = $(".item-id").val();
		if (confirm('Delete "'+itemList.get_item(id).title+'"?')==true) {
      itemList.remove_item(id);
		if(view=="tree")	view_item(current.id);
		else view_filter();
		}
    });
    
    // .finish-button
	$(document).on('click', ".finish-button", function() {
         id = $(".item-id").val();
         itemList.edit_from_form("#edit-item-form");
         itemList.finish_item(id);
			if(view=="tree")	view_item(current.id);
			else view_filter();
    });
	

	// .menu-button
    $(document).on('click', ".menu-button", function() {
        	$(".page").hide();
			$("#menu").show();
    });
	
	
	// .search-button
	$(document).on('click', ".search-button", function() {
		view_filter();
    });

	// .tree-button
	$(document).on('click', ".tree-button", function() {
		view_item(current.id);
    });
	
	function view_item (id) {
		view = "tree";
		current = itemList.get_item(id);
		
		itemList.refresh(id);
		$(".menu-title").html(current.title);
		if(current.id == 0) $("#tree>.submenu>.back-button").hide(); 
		else $("#tree>.submenu>.back-button").show();
	
		$(".page").hide();
		$("#tree").show();
	}
	
	//search
    function view_filter(){
        view = "filter";
        
        var query = $(".search").val();
        var type = $(".type-filter").val();
        
        itemList.filtered(type, query); 
        //$("#filtered>.subitem").show();
        //if(query!="") $("#filtered>.subitem>.subitem-center>.title:not(:contains('"+query+"'))").parent().parent().hide();
        //else $("#filtered>.subitem").show();
        
        $(".page").hide();
		  $("#search").show();
    }
    
	
</script>
